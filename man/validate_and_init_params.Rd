% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/iseq_download.R
\name{validate_and_init_params}
\alias{validate_and_init_params}
\title{Download Sequencing Data and Metadata}
\usage{
validate_and_init_params(
  input,
  output_dir,
  merge,
  database,
  threads,
  parallel,
  retries
)
}
\arguments{
\item{input}{Character vector of accession IDs, or a path to a file containing
one accession per line.}

\item{output_dir}{Path to the output directory. Will be created if it doesn't exist.
Defaults to the current working directory.}

\item{merge}{Character. Merge FASTQ files based on level: "ex" (Experiment),
"sa" (Sample), "st" (Study), or "none". Requires \code{sra-tools} if conversion needed. (Default: "none")}

\item{database}{Character. Preferred database for SRA/Run download: "ena" or "sra".
Note: Some data might only be available from one source. "auto" is not implemented here yet, defaults to ENA preference. (Default: "ena")}

\item{threads}{Integer. Number of threads for \code{fasterq-dump} and \code{pigz}. (Default: 8)}

\item{parallel}{Integer. Number of parallel connections for download using \code{axel}.
Requires \code{axel}. If 0, uses \code{wget}. (Default: 0)}

\item{retries}{Integer. Number of times to retry download/validation on failure. (Default: 2)}

\item{metadata_only}{Logical. If TRUE, only download metadata files, skip sequence data. (Default: FALSE)}

\item{gzip}{Logical. If TRUE, prefer downloading gzipped FASTQ files directly.
If not available or if SRA files are downloaded, SRA will be converted and
the resulting FASTQ files will be compressed using \code{pigz}. Requires \code{pigz}. (Default: FALSE)}

\item{fastq}{Logical. If TRUE, convert downloaded SRA files to FASTQ format using
\code{fasterq-dump}. Requires \code{sra-tools}. (Default: FALSE)}

\item{aspera}{Logical. Use Aspera (\code{ascp}) for download if available (ENA/GSA FTP sources only).
Requires \code{aspera-cli} and configured keys (see Details). (Default: FALSE)}

\item{remove_sra}{Logical. If TRUE and \code{fastq} or \code{gzip} is TRUE, remove the original SRA file
after successful conversion/compression. (Default: TRUE)}
}
\value{
Invisibly returns a list containing paths to successfully processed top-level accessions' metadata files.
}
\description{
Downloads data for Runs associated with a given accession (Project, Study,
Sample, Experiment, Run, GEO Series/Sample) from ENA/SRA or GSA databases.
}
\details{
\strong{Software Requirements:} This function relies on external command-line tools.
Ensure the following are installed and accessible in your system's PATH:
\itemize{
\item \code{wget} (required for basic download)
\item \code{md5sum} (from \code{coreutils}, for validation)
Optional, based on arguments:
\item \code{axel} (if \code{parallel > 0})
\item \code{pigz} (if \code{gzip = TRUE})
\item \code{sra-tools} (>= 2.11.0 recommended, provides \code{fasterq-dump}, \code{vdb-validate}, \code{srapath}) (if \code{fastq=TRUE} or SRA download occurs)
\item \code{aspera-cli} (provides \code{ascp}) (if \code{aspera = TRUE})
}

You can provide paths to these tools via R's \code{options()} if they are not in the PATH, e.g.,
\code{options(iseq.wget = "/path/to/wget", iseq.pigz = "/path/to/pigz")}.

\strong{Aspera Keys:} For Aspera downloads:
\itemize{
\item ENA: The key file (\code{aspera_bypass_rsa.pem} or \code{aspera_tokenauth_id_rsa}) is usually found
within the \code{aspera-cli} installation (e.g., \verb{.../etc/}). The function attempts to find it.
Alternatively, set \code{options(iseq.aspera_key_ena = "/path/to/ena_key.pem")}.
\item GSA: Requires a specific key file (\code{.asperaGSA.openssh}). The function will attempt to download it
from the GSA website to the \code{output_dir} if not found. Alternatively, place it there manually
or set \code{options(iseq.aspera_key_gsa = "/path/to/gsa_key.openssh")}.
}

\strong{Metadata:} Metadata files (\verb{<accession>.metadata.tsv} for ENA/SRA, \verb{<accession>.metadata.csv}
and potentially \verb{<CRA>.metadata.xlsx} for GSA) are saved in the \code{output_dir}.

\strong{Logging:} Download success and failures for individual runs are logged to \code{success.log} and \code{fail.log}
in the \code{output_dir}. Existing entries in \code{success.log} will cause runs to be skipped unless the log file is removed/edited.

\strong{Merging:} Merging concatenates FASTQ files. For GSA data, merging assumes FASTQ(.gz) files exist and follows naming conventions inferred during download; BAM or other file types are not merged.
}
\examples{
\dontrun{
# Example usage (ensure required software is installed)

# Set paths if not in PATH (example)
options(iseq.pigz = "/opt/homebrew/bin/pigz")
options(iseq.fasterq_dump = "/path/to/fasterq-dump")

# Download metadata only for a project
iseq_download("PRJNA12345", metadata_only = TRUE, output_dir = "project_meta")

# Download SRA, convert to FASTQ, compress, use 4 threads
iseq_download("SRR67890", fastq = TRUE, gzip = TRUE, threads = 4, output_dir = "srr_data")

# Download project data using Aspera, 10 parallel connections (if Aspera fails),
# prefer gzipped FASTQ, merge by sample
iseq_download("PRJEB9876",
  output_dir = "project_data",
  gzip = TRUE, aspera = TRUE, parallel = 10,
  merge = "sa", threads = 8
)

# Download from a file containing multiple accessions
writeLines(c("SRR1000", "SRR1001"), "accessions.txt")
iseq_download("accessions.txt", output_dir = "multi_srr", fastq = TRUE)
unlink("accessions.txt") # Clean up example file
}
Validate and initialize parameters
}
\keyword{internal}
